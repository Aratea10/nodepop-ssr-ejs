<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title><%= title %></title>
        <link rel="stylesheet" href="/stylesheets/base.css" />
        <link rel="stylesheet" href="/stylesheets/shop.css" />
    </head>
    <body>
        <h1><%= title %></h1>
        <div style="margin-bottom: 20px;">
            <a href="/">Todos los productos</a>
            <a href="/products/new" style="margin-left: 20px;">Crear producto</a>
        </div>
        <form method="get" action="/products">
            <label>Tag</label>
            <select name="tag">
                <option value="">--Any--</option>
                <option value="work" <%= (query.tag==='work'?'selected':'') %>>work</option>
                <option value="lifestyle" <%= (query.tag==='lifestyle'?'selected':'') %>>lifestyle</option>
                <option value="motor" <%= (query.tag==='motor'?'selected':'') %>>motor</option>
                <option value="mobile" <%= (query.tag==='mobile'?'selected':'') %>>mobile</option>
            </select>
            <label>Precio min</label>
            <input type="number" name="priceMin" value="<%= query.priceMin || '' %>" min="0" />
            <label>Precio max</label>
            <input type="number" name="priceMax" value="<%= query.priceMax || '' %>" min="0" />
            <label>Nombre empieza por</label>
            <input type="text" name="name" value="<%= query.name || '' %>" />
            <label>Por página</label>
            <input type="number" name="limit" value="<%= query.limit || 10 %>" min="1" />
            <button type="submit">Filtrar</button>
        </form>
        <ul>
            <% items.forEach(p => { %>
               <li>
                    <strong><%= p.name %></strong> - <%= p.price %>€<em>(<%= (p.tags || []).join(', ') %>)</em>
                    <button class="delete-button" data-product-name="<%= p.name %>" data-product-id="<%= p._id %>">Borrar</button>
               </li> 
            <% }) %>
        </ul>
        <div>
            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/products?<%= new URLSearchParams({ ...query, page: i }).toString() %>">
                    <%= i %>
                </a>
            <% } %>
        </div>
        <form method="post" action="/auth/logout" style="margin-top: 20px;">
            <button type="submit">Logout</button>
        </form>

        <div id="deleteModal" class="hidden">
            <div id="deleteMessage"></div>
            <button class="confirm-delete-button">Confirmar</button>
            <button class="cancel-delete-button">Cancelar</button>
        </div>

        <script src="/javascripts/product-list-ui.js"></script>
    </body>
</html>